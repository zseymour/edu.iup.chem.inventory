<html xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://jasperreports.sourceforge.net/jasperreports">
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JasperReports 5.0.0 - Map Component Sample</title>
<style type="text/css">
.title {
	font-family: Arial, Verdana, Helvetica, sans-serif;
	font-size: 28px;
	font-weight: normal;
}

.toc {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: normal;
}

.name {
	font-family: Courier New, Courier, serif;
	font-size: 16px;
	font-weight: bold;
}

.label {
	font-family: Arial, Verdana, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;
	font-style: italic;
}

.description {
	font-family: Arial, Verdana, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: normal;
}

.value {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: normal;
}

.element {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: normal;
}

.attribute {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: bold;
}

.code {
	font-family: Courier New, Courier, serif;
	font-size: 12px;
	font-weight: normal;
}

.copy {
	font-decoration: none;
	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 8pt;
	font-style: normal;
	color: #000000;
}

.subtitle {
	font-family: inherit;
	font-size: inherit;
	font-style: inherit;
	font-weight: bold;
	text-decoration: none;
	color: inherit;
}

</style>
</head>
<body bgcolor="#FFFFFF">
<a name="top"></a>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
<tr>
<td colspan="2" align="right"><span class="element"><a href="../../JasperReports-Ultimate-Guide-3.pdf">JasperReports Ultimate Guide</a> - <a href="../../sample.reference.html">Sample Reference</a> - <a href="../../schema.reference.html">Schema Reference</a> - <a href="../../config.reference.html">Configuration Reference</a> - <a href="http://jasperreports.sourceforge.net/api/index.html">API (Javadoc)</a></span>
<br>
</td>
</tr>
<tr>
<td colspan="2">
<hr size="1">
</td>
</tr>
<tr valign="middle">
<td nowrap="true"><span class="title">JasperReports - Map Component Sample (version 5.0.0)</span></td><td align="right"><img src="../../resources/jasperreports.png" border="0"></td>
</tr>
<tr>
<td colspan="2">
<hr size="1">
</td>
</tr>
</table>
<br>
<span class="description"><span class="description">Illustrates the usage of the map component element.</span></span>
<br>
<br>
<span class="element"><a href="http://sourceforge.net/projects/jasperreports/files/jasperreports/JasperReports%205.0.0/jasperreports-5.0.0-project.zip/download" target="_blank">Download All Sample Source Files</a></span>
<br>
<span class="element"><a href="http://jasperforge.org/scm/viewvc.php/tags/jr-5-0-0/jasperreports/demo/samples/map/?root=jasperreports" target="_blank">Browse Sample Source Files on SVN</a></span>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr>
<td style="width: 20px;">
<br>
</td><td>
<br>
</td>
</tr>
<tr>
<td colspan="2"><span class="label">Main Features in This Sample</span></td>
</tr>
<tr>
<td>
<br>
</td><td><span class="element"><a href="#map">Using the Built-in Map Component</a></span></td>
</tr>
</table>
<table width="100%" cellspacing="0" cellpadding="0" border="0">
<tr>
<td><img src="../../resources/px.gif" border="0" width="20" height="1"></td><td><img src="../../resources/px.gif" border="0" width="20" height="1"></td><td><img src="../../resources/px.gif" border="0" width="20" height="1"></td><td><img src="../../resources/px.gif" border="0" width="20" height="1"></td><td width="80%">
<br>
</td><td width="20%">
<br>
</td>
</tr>
<tr>
<td colspan="6" align="right"><a name="map"></a><a href="#top" class="toc">top</a></td>
</tr>
<tr>
<td colspan="6">
<hr size="1">
</td>
</tr>
<tr valign="top">
<td><img src="../../resources/jr-16x16.png" border="0"></td><td colspan="4"><span class="name">Using the Built-in Map Component</span></td><td align="right"><span class="copy">Documented by 
	<a href="mailto:shertage@users.sourceforge.net" class="copy">Sanda Zaharia</a></span></td>
</tr>
<tr>
<td colspan="6">
<br>
</td>
</tr>
<tr valign="top">
<td>
<br>
</td><td nowrap="true"><span class="label">Description / Goal</span></td><td>
<br>
</td><td colspan="3"><span class="description">
How to render maps using the built-in map component.
    </span></td>
</tr>
<tr valign="top">
<td>
<br>
</td><td colspan="1"><span class="label">Since</span></td><td>
<br>
</td><td colspan="3"><span class="description">4.1.1</span></td>
</tr>
<tr>
<td colspan="6">
<br>
</td>
</tr>
<tr>
<td>
<br>
</td><td colspan="5"><span class="description">
<b>Map Component Overview</b>    

<br>

<br>
The JR built-in <span class="code"><code>map</code></span> component is based on the public 
<a href="http://code.google.com/apis/maps/documentation/javascript/reference.html" target="_blank" class="element">Google Maps APIs</a>. 
It exposes some of the main characteristics necessary to generate the most common maps, but feature upgrades 
for this component are planned for future development. The current <span class="code"><code>map</code></span> component description is found 
in the <a href="../../components.schema.reference.html" target="_blank" class="element">components.xsd</a> schema:
<pre>
&lt;element name="map" substitutionGroup="jr:component"&gt;
  &lt;complexType&gt;
    &lt;complexContent&gt;
      &lt;extension base="jr:componentType"&gt;
        &lt;sequence&gt;
          &lt;element name="latitudeExpression"&gt;
            &lt;complexType mixed="true"/&gt;
          &lt;/element&gt;
          &lt;element name="longitudeExpression"&gt;
            &lt;complexType mixed="true"/&gt;
          &lt;/element&gt;
          &lt;element name="zoomExpression" minOccurs="0" maxOccurs="1"&gt;
            &lt;complexType mixed="true"/&gt;
          &lt;/element&gt;
          &lt;element name="languageExpression" minOccurs="0" maxOccurs="1"&gt;
            &lt;complexType mixed="true"/&gt;
          &lt;/element&gt;
          &lt;element ref="c:markerDataset" minOccurs="0" maxOccurs="1"/&gt;            
        &lt;/sequence&gt;
        &lt;attribute name="evaluationTime" type="jr:basicEvaluationTime" use="optional" default="Now"/&gt;
        &lt;attribute name="evaluationGroup" type="string" use="optional"/&gt;
        &lt;attribute name="mapType" use="optional" default="roadmap"&gt;
          &lt;simpleType&gt;
            &lt;restriction base="string"&gt;
              &lt;enumeration value="roadmap"/&gt;
              &lt;enumeration value="satellite"/&gt;
              &lt;enumeration value="terrain"/&gt;
              &lt;enumeration value="hybrid"/&gt;
            &lt;/restriction&gt;
          &lt;/simpleType&gt;
        &lt;/attribute&gt;
        &lt;attribute name="mapScale" use="optional" default="1"&gt;
          &lt;simpleType&gt;
            &lt;restriction base="unsignedInt"&gt;
              &lt;enumeration value="1"/&gt;
              &lt;enumeration value="2"/&gt;
              &lt;enumeration value="4"/&gt;
            &lt;/restriction&gt;
          &lt;/simpleType&gt;
        &lt;/attribute&gt;
        &lt;attribute name="imageType" use="optional" default="png"&gt;
          &lt;simpleType&gt;
            &lt;restriction base="string"&gt;
              &lt;enumeration value="png"/&gt;
              &lt;enumeration value="png8"/&gt;
              &lt;enumeration value="png32"/&gt;
              &lt;enumeration value="gif"/&gt;
              &lt;enumeration value="jpg"/&gt;
              &lt;enumeration value="jpg-baseline"/&gt;
            &lt;/restriction&gt;
          &lt;/simpleType&gt;
        &lt;/attribute&gt;
      &lt;/extension&gt;
    &lt;/complexContent&gt;
  &lt;/complexType&gt;
&lt;/element&gt;

&lt;element name="markerDataset"&gt;
  &lt;annotation&gt;
    &lt;documentation&gt;Creates a dataset with one or more marker objects&lt;/documentation&gt;
  &lt;/annotation&gt;
  &lt;complexType&gt;
    &lt;sequence&gt;
      &lt;element ref="jr:datasetRun" minOccurs="0" maxOccurs="1"/&gt;
      &lt;element ref="c:marker" minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/sequence&gt;
  &lt;/complexType&gt;
&lt;/element&gt;

&lt;complexType name="MarkerProperty"&gt;
  &lt;sequence&gt;
    &lt;element ref="jr:valueExpression" minOccurs="0" maxOccurs="1"/&gt;
  &lt;/sequence&gt;
  &lt;attribute name="name" type="string" use="required" /&gt;
  &lt;attribute name="value" type="string" use="optional" /&gt;
&lt;/complexType&gt;

&lt;element name="marker"&gt;
  &lt;complexType&gt;
    &lt;sequence&gt;
      &lt;element name="markerProperty" type="c:MarkerProperty" minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/sequence&gt;
  &lt;/complexType&gt;
&lt;/element&gt;</pre>

<b>Map Attributes</b>

<br>    

<br> 
One can customize the map component using the following attributes:
<ul>

<li>
<span class="code"><code>mapType</code></span> - indicates the map type. Possible values are:
<ul>

<li>
<span class="code"><code>roadmap</code></span> (default)</li>

<li>
<span class="code"><code>satellite</code></span>
</li>

<li>
<span class="code"><code>terrain</code></span>
</li>

<li>
<span class="code"><code>hybrid</code></span>
<br>
<br>
</li>

</ul>

</li>

<li>
<span class="code"><code>mapScale</code></span> - represents the <span class="code"><code>scale</code></span> value used to return higher-resolution map images when 
working with high resolution screens available on mobile devices.  Possible values are:
<ul>

<li>
<span class="code"><code>1</code></span> (default)</li>

<li>
<span class="code"><code>2</code></span>
</li>

<li>
<span class="code"><code>4</code></span> (for Business customers only)<br>
<br>
</li>

</ul>

</li>

<li>
<span class="code"><code>imageType</code></span> - represents the image format of the map. Possible values are:
<ul>

<li>
<span class="code"><code>png</code></span> (default)</li>

<li>
<span class="code"><code>png8</code></span>
</li>

<li>
<span class="code"><code>png32</code></span>
</li>

<li>
<span class="code"><code>gif</code></span>
</li>

<li>
<span class="code"><code>jpg</code></span>
</li>

<li>
<span class="code"><code>jpg-baseline</code></span>
</li>

</ul>

</li>

</ul>   

<b>The Latitude Expression</b>    

<br>

<br>
The <span class="code"><code>&lt;c:latitudeExpression/&gt;</code></span> represents the latitude coordinate of the main area, necessary to locate it on the Earth surface. 
Allowed values are floating point numbers representing degrees from -90&deg; to 90&deg;. The default value is 0.
<br>

<br>

<b>The Longitude Expression</b>    

<br>

<br>
The <span class="code"><code>&lt;c:longitudeExpression/&gt;</code></span> represents the longitude coordinate of the main area, necessary to locate it on the Earth surface. 
Allowed values are floating point numbers representing degrees from -90&deg; to 90&deg;. The default value is 0.
<br>

<br>

<b>The Zoom Expression</b>    

<br>

<br>
The <span class="code"><code>&lt;c:zoomExpression/&gt;</code></span> represents the initial map zoom level. The expression allows integer values and defaults to 0. 
<br>

<br>

<b>The Language Expression</b>    

<br>

<br>
The <span class="code"><code>&lt;c:languageExpression/&gt;</code></span> represents the language code used to localize the textual information displayed on the map, 
such as control names, copyright notices and other various labels. Supported languages can be found 
<a href="https://spreadsheets.google.com/pub?key=p9pdwsai2hDMsLkXsoM05KQ&amp;gid=1" target="_blank" class="element">here</a>.
<br>

<br>

<b>The Marker Dataset</b>    

<br>

<br>
The <span class="code"><code>&lt;c:markerDataset/&gt;</code></span> element is used to generate the list of marker elements to be displayed on the map. It can collect  
its data either from a subdataset, or from a hardcoded list of marker elements as shown in the component schema. 
<br>
The marker element contains a list of specific properties that can be set either by value or by valueExpression. With few exceptions, property names must 
match the names of supported marker options available <a href="https://developers.google.com/maps/documentation/javascript/reference#MarkerOptions" target="_blank" class="element">here</a>. 
<br>
The exceptions are the <span class="code"><code>latitude</code></span> and <span class="code"><code>longitude</code></span> property names, both required in order to compute the marker position on the map. If at least one 
of these two properties is missing or is empty, an exception will be thrown.
<br>

<br>

<b>Warning:</b> To avoid such exceptions when using a subdataset, use a <span class="code"><code>&lt;filterExpression&gt;</code></span> to skip markers with empty latitude/longitude 
properties. An example can be found in the map component sample.
<br>

<br>

<b>Map Component Example</b>    

<br>

<br>
The JRXML sample contains two <span class="code"><code>map</code></span> components that illustrate how various settings can be applied in order to get the desired map rendering:
<pre>
&lt;componentElement&gt;
  &lt;reportElement x="0" y="20" width="515" height="326" /&gt;
  &lt;c:map xmlns:c="http://jasperreports.sourceforge.net/jasperreports/components" 
    xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd" evaluationTime="Report"&gt;
    &lt;c:latitudeExpression&gt;&lt;![CDATA[$P{latitude}]] &gt;&lt;/c:latitudeExpression&gt;
    &lt;c:longitudeExpression&gt;&lt;![CDATA[$P{longitude}]] &gt;&lt;/c:longitudeExpression&gt;
    &lt;c:zoomExpression&gt;&lt;![CDATA[$P{zoom}]] &gt;&lt;/c:zoomExpression&gt;
    &lt;c:languageExpression&gt;&lt;![CDATA[new java.util.Locale("ro").getLanguage()]] &gt;&lt;/c:languageExpression&gt;
  &lt;/c:map&gt;
&lt;/componentElement&gt;

...

&lt;componentElement&gt;
  &lt;reportElement x="0" y="366" width="515" height="326"/&gt;
  &lt;c:map xmlns:c="http://jasperreports.sourceforge.net/jasperreports/components" 
    xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd"
    mapType="satellite" mapScale="1" imageType="jpg"&gt;
    &lt;c:latitudeExpression&gt;&lt;![CDATA[37.788056f]] &gt;&lt;/c:latitudeExpression&gt;
    &lt;c:longitudeExpression&gt;&lt;![CDATA[-122.4075f]] &gt;&lt;/c:longitudeExpression&gt;
    &lt;c:zoomExpression&gt;&lt;![CDATA[$P{zoom} + 1]] &gt;&lt;/c:zoomExpression&gt;
    &lt;c:markerDataset&gt;
      &lt;datasetRun subDataset="MarkersDataset"/&gt;
      &lt;c:marker&gt;
        &lt;c:markerProperty name="latitude"&gt;
          &lt;valueExpression&gt;$F{latitude}&lt;/valueExpression&gt;
        &lt;/c:markerProperty&gt;
        &lt;c:markerProperty name="longitude"&gt;
          &lt;valueExpression&gt;$F{longitude}&lt;/valueExpression&gt;
        &lt;/c:markerProperty&gt;
        &lt;c:markerProperty name="title"&gt;
          &lt;valueExpression&gt;$F{address}&lt;/valueExpression&gt;
        &lt;/c:markerProperty&gt;
      &lt;/c:marker&gt;
    &lt;/c:markerDataset&gt;
  &lt;/c:map&gt;
&lt;/componentElement&gt;</pre>
The first map is centered on Bucharest, Romania. It provides settings for all map expressions, but comes with no markers, because the <span class="code"><code>&lt;c:markerDataset/&gt;</code></span> element 
is missing.
<br>
The second map is centered on San Francisco, CA. One can notice several customizations here, including the map type, map scale and image type. A set of markers are also present 
on the map, based on the datasource prepared by the CSV data adapter in <span class="code"><code>MarkersDataset</code></span> subdataset. Data with invalid latitude/longitude values are skipped due to the 
<span class="code"><code>&lt;filterExpression/&gt;</code></span> in the subdataset.
<br>

<br>

<b>Running the Sample</b>

<br>

<br>
Running the sample requires the <a href="http://ant.apache.org/" target="_blank" class="element">Apache Ant</a> library. Make sure that <span class="code"><code>ant</code></span> is already installed on your system (version 1.5 or later).
<br>
In a command prompt/terminal window set the current folder to <span class="code"><code>demo/samples/map</code></span> within the JasperReports source project and run the <span class="code"><code>&gt; ant test view</code></span> command.
<br>
It will generate all supported document types containing the sample report in the <span class="code"><code>demo/samples/map/build/reports</code></span> directory. 
<br>
Then the report will open in the JasperReports internal viewer.
    </span></td>
</tr>
<tr>
<td colspan="6">
<br>
</td>
</tr>
</table>
<br>
<table cellspacing="0" cellpadding="0" border="0" width="100%">
<tr>
<td>
<hr size="1">
</td>
</tr>
<tr>
<td align="center"><span class="copy">&copy; 2001-<script language="javascript">document.write((new Date()).getFullYear())</script> Jaspersoft Corporation <a href="http://www.jaspersoft.com" target="_blank" class="copy">www.jaspersoft.com</a></span></td>
</tr>
</table>
</body>
</html>
